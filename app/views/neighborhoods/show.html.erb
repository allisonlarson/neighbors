<div class="col-md-2">
  <div class="list-group" id='sidebar-padding'>

    <%= link_to @area.city.name, city_path(@area.city),"data-no-turbolink" => true, class:'btn list-group-item denver sidebar-button' %>
    <%= link_to 'Search', root_path, class:'btn search list-group-item sidebar-button' %>
    <br>
    <% @filters.each do |filter| %>
      <%= link_to filter, '#', class:'btn list-group-item sidebar-button' %>
    <% end %>

  </div>
</div>

<div class="col-md-8">
  <div id="map-canvas" style="height: 500px; width: 1020px;">
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=true_or_false"></script>

    <script>
      var map;
      function initialize() {

        var mapOptions = {
          zoom: 13,
          center: new google.maps.LatLng(<%=@area.coordinates.first.lat%>, <%=@area.coordinates.first.lon%>)
        };

        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);

        var markerBounds = new google.maps.LatLngBounds();

        var neighborhoodCoords = [
          <% @area.coordinates.each do |coord| %>
            new google.maps.LatLng(<%=coord.lat%>, <%=coord.lon%>),
          <%end%>
        ];

        var neighborhood = new google.maps.Polygon({
          paths: neighborhoodCoords,
          strokeColor: '#919191',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#CFCFCF',
          fillOpacity: 0.5
        });

        neighborhood.setMap(map);

        var markers = [];

        var infoWindow = new google.maps.InfoWindow({
          content: 'stuff'
        });

        <% @establishments.each do |estab| %>
          var myLatlng = new google.maps.LatLng(<%=estab.latitude%>, <%=estab.longitude%>);

          if(google.maps.geometry.poly.containsLocation(myLatlng, neighborhood)){

            var <%= name_to_variable(estab.name) %> = new google.maps.Marker({
                position: myLatlng,
                map: map,
                title:"<%=estab.name%>"
            });

            markers.push(<%= name_to_variable(estab.name) %>);

              <%= name_to_variable(estab.name) %>.setMap(map);

            google.maps.event.addListener(<%= name_to_variable(estab.name) %>, 'click', function(){
              infoWindow.setContent(this.title);
              infoWindow.open(map, this);
            });
          }

        <%end%>

        for(var i=0; i<neighborhoodCoords.length; i++){
           markerBounds.extend(neighborhoodCoords[i]);
        }

        map.fitBounds(markerBounds);





      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </div>
</div>
